<Project Sdk="Microsoft.NET.Sdk">

  <Target Name="RefreshTestAssets"
          DependsOnTargets="GetProductVersions">
    <PropertyGroup>
      <TempFolderRoot>$(IntermediateOutputPath)temp\</TempFolderRoot>
    </PropertyGroup>

    <ItemGroup>
      <DirsToClean Include="$(TestDir)**\bin" />
      <DirsToClean Include="$(TestDir)**\obj" />
      <DirsToClean Include="$(TempFolderRoot)$(TargetArchitecture)" />

      <TestAssetProjectToRestore Include="$(TestAssetsDir)**\*.csproj" />

      <AllTestRestoreSources Include="@(RestoreTestSource)"/>
      <AllTestRestoreSources Include="@(RestoreTestFallbackSource)"/>
    </ItemGroup>

    <PropertyGroup>
      <AllTestRestoreSources>@(AllTestRestoreSources, '%3B')</AllTestRestoreSources>
    </PropertyGroup>

    <RemoveDir Directories="@(DirsToClean)" />
    <MakeDir Directories="$(TempFolderRoot)NuGetFallbackFolder" />

    <MSBuild
      Projects="@(TestAssetProjectToRestore)"
      Targets="Restore"
      Properties="
        RestoreSources=$(AllTestRestoreSources);
        RestorePackagesPath=$(PackagesDir);
        RestoreNoCache=true;
        MNAVersion=$(ProductVersion)" />
  </Target>

</Project>
